import importlib<br/>import time<br/>import re<br/>from sys import argv<br/>from typing import Optional<br/>import Tianabot.modules.sql.users_sql as sql<div></div>from Tianabot import (<br/>ALLOW_EXCL,<br/>CERT_PATH,<br/>DONATION_LINK,<br/>LOGGER,<br/>OWNER_ID,<br/>PORT,<br/>BOT_TUT,<br/>MUSICBOT_TUT,<br/>UPDATE_CHANNEL,<br/>BOT_USERNAME,<br/>BOT_NAME,<br/>ASS_USERNAME,<br/>START_IMG,<br/>TOKEN,<br/>URL,<br/>OWNER_USERNAME,<br/>WEBHOOK,<br/>SUPPORT_CHAT,<br/>dispatcher,<br/>StartTime,<br/>telethn,<br/>pbot,<br/>updater,<br/>)<div></div># needed to dynamically load modules<br/># NOTE: Module order is not guaranteed, specify that in the config file!<br/>from Tianabot.modules import ALL_MODULES<br/>from Tianabot.modules.helper_funcs.chat_status import is_user_admin<br/>from Tianabot.modules.helper_funcs.misc import paginate_modules<br/>from telegram import InlineKeyboardButton, InlineKeyboardMarkup, ParseMode, Update<br/>from telegram.error import (<br/>BadRequest,<br/>ChatMigrated,<br/>NetworkError,<br/>TelegramError,<br/>TimedOut,<br/>Unauthorized,<br/>)<br/>from telegram.ext import (<br/>CallbackContext,<br/>CallbackQueryHandler,<br/>CommandHandler,<br/>Filters,<br/>MessageHandler,<br/>)<br/>from telegram.ext.dispatcher import DispatcherHandlerStop, run_async<br/>from telegram.utils.helpers import escape_markdown<div></div>def get_readable_time(seconds: int) -> str:<br/>count = 0<br/>ping_time = ""<br/>time_list = []<br/>time_suffix_list = ["s", "m", "h", "days"]<div></div>while count < 4:<br/>count += 1<br/>remainder, result = divmod(seconds, 60) if count < 3 else divmod(seconds, 24)<br/>if seconds == 0 and remainder == 0:<br/>break<br/>time_list.append(int(result))<br/>seconds = int(remainder)<div></div>for x in range(len(time_list)):<br/>time_list[x] = str(time_list[x]) + time_suffix_list[x]<br/>if len(time_list) == 4:<br/>ping_time += time_list.pop() + ", "<div></div>time_list.reverse()<br/>ping_time += ":".join(time_list)<div></div>return ping_time<div></div>PM_START_TEXT = """<br/>*H·¥á ü ü·¥è {} * [!]({})<br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<br/>√ó *I'·¥ç A…¥…™·¥ç·¥á-T ú·¥á·¥ç·¥á G Ä·¥è·¥ú·¥ò M·¥Ä…¥·¥Ä…¢·¥á·¥ç·¥á…¥·¥õ B·¥è·¥õ*<br/>√ó *I'·¥ç V·¥á Ä è F·¥ÄÍú±·¥õ A…¥·¥Ö M·¥è Ä·¥á EÍú∞Íú∞…™·¥Ñ…™·¥á…¥·¥õ I P Ä·¥è·¥†…™·¥Ö·¥á A·¥°·¥áÍú±·¥è·¥ç·¥á F·¥á·¥Ä·¥õ·¥ú Ä·¥áÍú±!*<br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<br/>√ó *U·¥ò·¥õ…™·¥ç·¥á:* `{}`<br/>√ó `{}` *UÍú±·¥á Ä, A·¥Ñ Ä·¥èÍú±Íú±* `{}` *C ú·¥Ä·¥õÍú±.*<br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"""<div></div>buttons = [<br/>[<br/>InlineKeyboardButton(text=" ú·¥á ü·¥ò&·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ös", callback_data="tiana_"),<br/>],<br/>[<br/>InlineKeyboardButton(text="…™…¥“ì·¥è", callback_data="about_"),<br/>InlineKeyboardButton(text="·¥è·¥°…¥·¥á Ä", url=f"https://t.me/{OWNER_USERNAME}"),<br/>],<br/>[<br/>InlineKeyboardButton(text="·¥ú·¥ò·¥Ö·¥Ä·¥õ·¥ás", url=f"http://t.me/{UPDATE_CHANNEL}"),<br/>InlineKeyboardButton(text="s·¥ú·¥ò·¥ò·¥è Ä·¥õ", url=f"https://t.me/{SUPPORT_CHAT}"),<br/>],<br/>[ <br/>InlineKeyboardButton(text="·¥Ä·¥Ö·¥Ö ·¥õ·¥á·¥Ñ ú…¥·¥è ·¥õ·¥è  è·¥è·¥ú Ä …¢ Ä·¥è·¥ú·¥ò", url=f"https://t.me/{BOT_USERNAME}?startgroup=true"),<br/>], <div></div>]<div></div>TIANA_IMG = f"{START_IMG}"<br/>TIANA_VIDA = f"{BOT_TUT}"<br/>TIANA_VIDB = f"{MUSICBOT_TUT}"<div></div>HELP_STRINGS = """*Click on the Buttons Bellow to get Documention about Specific Modules*"""<div></div>IMPORTED = {}<br/>MIGRATEABLE = []<br/>HELPABLE = {}<br/>STATS = []<br/>USER_INFO = []<br/>DATA_IMPORT = []<br/>DATA_EXPORT = []<br/>CHAT_SETTINGS = {}<br/>USER_SETTINGS = {}<div></div>for module_name in ALL_MODULES:<br/>imported_module = importlib.import_module("Tianabot.modules." + module_name)<br/>if not hasattr(imported_module, "__mod_name__"):<br/>imported_module.__mod_name__ = imported_module.__name__<div></div>if imported_module.__mod_name__.lower() not in IMPORTED:<br/>IMPORTED[imported_module.__mod_name__.lower()] = imported_module<br/>else:<br/>raise Exception("Can't have two modules with the same name! Please change one")<div></div>if hasattr(imported_module, "__help__") and imported_module.__help__:<br/>HELPABLE[imported_module.__mod_name__.lower()] = imported_module<div></div>if hasattr(imported_module, "__sub_mod__") and imported_module.__sub_mod__:<br/>SUB_MODE[imported_module.__mod_name__.lower()] = imported_module<div></div># Chats to migrate on chat_migrated events<br/>if hasattr(imported_module, "__migrate__"):<br/>MIGRATEABLE.append(imported_module)<div></div>if hasattr(imported_module, "__stats__"):<br/>STATS.append(imported_module)<div></div>if hasattr(imported_module, "__user_info__"):<br/>USER_INFO.append(imported_module)<div></div>if hasattr(imported_module, "__import_data__"):<br/>DATA_IMPORT.append(imported_module)<div></div>if hasattr(imported_module, "__export_data__"):<br/>DATA_EXPORT.append(imported_module)<div></div>if hasattr(imported_module, "__chat_settings__"):<br/>CHAT_SETTINGS[imported_module.__mod_name__.lower()] = imported_module<div></div>if hasattr(imported_module, "__user_settings__"):<br/>USER_SETTINGS[imported_module.__mod_name__.lower()] = imported_module<div></div><br/># do not async<br/>def send_help(chat_id, text, keyboard=None):<br/>if not keyboard:<br/>keyboard = InlineKeyboardMarkup(paginate_modules(0, HELPABLE, "help"))<br/>dispatcher.bot.send_message(<br/>chat_id=chat_id,<br/>text=text,<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=keyboard,<br/>)<div></div><br/>@run_async<br/>def test(update: Update, context: CallbackContext):<br/># pprint(eval(str(update)))<br/># update.effective_message.reply_text("Hola tester! _I_ *have* `markdown`", parse_mode=ParseMode.MARKDOWN)<br/>update.effective_message.reply_text("This person edited a message")<br/>print(update.effective_message)<div></div><br/>@run_async<br/>def start(update: Update, context: CallbackContext):<br/>args = context.args<br/>uptime = get_readable_time((time.time() - StartTime))<br/>if update.effective_chat.type == "private":<br/>if len(args) >= 1:<br/>if args[0].lower() == "help":<br/>send_help(update.effective_chat.id, HELP_STRINGS)<br/>elif args[0].lower().startswith("ghelp_"):<br/>mod = args[0].lower().split("_", 1)[1]<br/>if not HELPABLE.get(mod, False):<br/>return<br/>send_help(<br/>update.effective_chat.id,<br/>HELPABLE[mod].__help__,<br/>InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="‚¨ÖÔ∏è BACK", callback_data="help_back")]]<br/>),<br/>)<div></div>elif args[0].lower().startswith("stngs_"):<br/>match = re.match("stngs_(.*)", args[0].lower())<br/>chat = dispatcher.bot.getChat(match.group(1))<div></div>if is_user_admin(chat, update.effective_user.id):<br/>send_settings(match.group(1), update.effective_user.id, False)<br/>else:<br/>send_settings(match.group(1), update.effective_user.id, True)<div></div>elif args[0][1:].isdigit() and "rules" in IMPORTED:<br/>IMPORTED["rules"].send_rules(update, args[0], from_pm=True)<div></div>else: <br/>first_name = update.effective_user.first_name<br/>update.effective_message.reply_text(<br/>PM_START_TEXT.format(<br/>escape_markdown(first_name),<br/>START_IMG,<br/>escape_markdown(uptime),<br/>sql.num_users(),<br/>sql.num_chats()),<br/>reply_markup=InlineKeyboardMarkup(buttons),<br/>parse_mode=ParseMode.MARKDOWN,<br/>timeout=60,<br/>)<br/>else:<br/>first_name = update.effective_user.first_name<br/>update.effective_message.reply_photo(<br/>TIANA_IMG, caption="""*H·¥á ü ü·¥è {} !*<br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<br/>√ó *I'·¥ç A…¥…™·¥ç·¥á-T ú·¥á·¥ç·¥á G Ä·¥è·¥ú·¥ò M·¥Ä…¥·¥Ä…¢·¥á·¥ç·¥á…¥·¥õ B·¥è·¥õ*<br/>√ó *I'·¥ç V·¥á Ä è F·¥ÄÍú±·¥õ A…¥·¥Ö M·¥è Ä·¥á EÍú∞Íú∞…™·¥Ñ…™·¥á…¥·¥õ I P Ä·¥è·¥†…™·¥Ö·¥á A·¥°·¥áÍú±·¥è·¥ç·¥á F·¥á·¥Ä·¥õ·¥ú Ä·¥áÍú±!*<br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<br/>√ó *U·¥ò·¥õ…™·¥ç·¥á:* `{}`<br/>√ó `{}` *UÍú±·¥á Ä, A·¥Ñ Ä·¥èÍú±Íú±* `{}` *C ú·¥Ä·¥õÍú±.*<br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ""".format(<br/>escape_markdown(first_name),<br/>escape_markdown(uptime),<br/>sql.num_users(),<br/>sql.num_chats()),<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[InlineKeyboardButton(text="üìÑ Source", url="https://github.com/prince-botz/tianabot"), <br/>InlineKeyboardButton(text="ü´Ç Support", url=f"https://t.me/{SUPPORT_CHAT}")]<br/>]<br/>),<br/>parse_mode=ParseMode.MARKDOWN, <br/>)<div></div><br/>def error_handler(update, context):<br/>"""Log the error and send a telegram message to notify the developer."""<br/># Log the error before we do anything else, so we can see it even if something breaks.<br/>LOGGER.error(msg="Exception while handling an update:", exc_info=context.error)<div></div># traceback.format_exception returns the usual python message about an exception, but as a<br/># list of strings rather than a single string, so we have to join them together.<br/>tb_list = traceback.format_exception(<br/>None, context.error, context.error.__traceback__<br/>)<br/>tb = "".join(tb_list)<div></div># Build the message with some markup and additional information about what happened.<br/>message = (<br/>"An exception was raised while handling an update\n"<br/>"update = {}\n\n"<br/>"{}"<br/>).format(<br/>html.escape(json.dumps(update.to_dict(), indent=2, ensure_ascii=False)),<br/>html.escape(tb),<br/>)<div></div>if len(message) >= 4096:<br/>message = message[:4096]<br/># Finally, send the message<br/>context.bot.send_message(chat_id=OWNER_ID, text=message, parse_mode=ParseMode.HTML)<div></div><br/># for test purposes<br/>def error_callback(update: Update, context: CallbackContext):<br/>error = context.error<br/>try:<br/>raise error<br/>except Unauthorized:<br/>print("no nono1")<br/>print(error)<br/># remove update.message.chat_id from conversation list<br/>except BadRequest:<br/>print("no nono2")<br/>print("BadRequest caught")<br/>print(error)<div></div># handle malformed requests - read more below!<br/>except TimedOut:<br/>print("no nono3")<br/># handle slow connection problems<br/>except NetworkError:<br/>print("no nono4")<br/># handle other connection problems<br/>except ChatMigrated as err:<br/>print("no nono5")<br/>print(err)<br/># the chat_id of a group has changed, use e.new_chat_id instead<br/>except TelegramError:<br/>print(error)<br/># handle all other telegram related errors<div></div><br/>@run_async<br/>def help_button(update, context):<br/>query = update.callback_query<br/>mod_match = re.match(r"help_module\((.+?)\)", query.data)<br/>back_match = re.match(r"help_back", query.data)<div></div>print(query.message.chat.id)<div></div>try:<br/>if mod_match:<br/>module = mod_match.group(1)<br/>text = (<br/>"„Äå H·¥á ü·¥ò ·¥è“ì *{}* „Äç:\n".format(<br/>HELPABLE[module].__mod_name__<br/>)<br/>+ HELPABLE[module].__help__<br/>)<br/>query.message.edit_text(<br/>text=text,<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="„Äå B·¥Ä·¥Ñ·¥ã „Äç", callback_data="help_back")]]<br/>),<br/>)<div></div>elif back_match:<br/>query.message.edit_text(<br/>text=HELP_STRINGS,<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>paginate_modules(0, HELPABLE, "help")<br/>),<br/>)<div></div># ensure no spinny white circle<br/>context.bot.answer_callback_query(query.id)<br/># query.message.delete()<div></div>except BadRequest:<br/>pass<div></div><br/>@run_async<br/>def tiana_callback_handler(update, context):<br/>query = update.callback_query<br/>if query.data == "tiana_":<br/>query.message.edit_text(<br/>text="""·¥°·¥á ü·¥Ñ·¥è·¥ç·¥á ·¥õ·¥è  ú·¥á ü·¥ò ·¥ç·¥á…¥·¥ú. <br/>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<br/>*S·¥á ü·¥á·¥Ñ·¥õ A ü ü C·¥è·¥ç·¥ç·¥Ä…¥·¥Ös F·¥è Ä F·¥ú ü ü H·¥á ü·¥ò O Ä S·¥á ü·¥á·¥Ñ·¥õ C·¥Ä·¥õ·¥Ä…¢·¥è Ä è F·¥è Ä M·¥è Ä·¥á H·¥á ü·¥ò D·¥è·¥Ñ·¥ú·¥ç·¥á…¥·¥õ·¥Ä·¥õ…™·¥è…¥ O…¥ S·¥á ü·¥á·¥Ñ·¥õ·¥á·¥Ö F…™·¥á ü·¥Ös*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(text="·¥Ä ü ü ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ös", callback_data="help_back"),<br/>], <br/>[InlineKeyboardButton(text=" ú·¥è·¥° ·¥õ·¥è ·¥ús·¥á ·¥ç·¥á", callback_data="tiana_help"),<br/>InlineKeyboardButton(text="·¥ç·¥ús…™·¥Ñ s ès·¥õ·¥á·¥ç", callback_data="tiana_music")],<br/>[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_back"),<br/>InlineKeyboardButton(text="…™…¥ ü…™…¥·¥á üîó", switch_inline_query_current_chat="")],<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_back":<br/>first_name = update.effective_user.first_name<br/>uptime = get_readable_time((time.time() - StartTime))<br/>query.message.edit_text(<br/>PM_START_TEXT.format(<br/>escape_markdown(first_name),<br/>START_IMG,<br/>escape_markdown(uptime),<br/>sql.num_users(),<br/>sql.num_chats()),<br/>reply_markup=InlineKeyboardMarkup(buttons),<br/>parse_mode=ParseMode.MARKDOWN,<br/>timeout=60,<br/>disable_web_page_preview=False,<br/>)<br/>elif query.data == "tiana_help":<br/>query.message.edit_text(<br/>text=f"""*N·¥á·¥° T·¥è {BOT_NAME}! H·¥á Ä·¥á Is T ú·¥á Q·¥ú…™·¥Ñ·¥ã S·¥õ·¥Ä Ä·¥õ G·¥ú…™·¥Ö·¥á W ú…™·¥Ñ ú W…™ ü ü H·¥á ü·¥ò Y·¥è·¥ú T·¥è U…¥·¥Ö·¥á Äs·¥õ·¥Ä…¥·¥Ö W ú·¥Ä·¥õ Is {BOT_NAME} A…¥·¥Ö H·¥è·¥° T·¥è Us·¥á I·¥õ.<div></div>C ü…™·¥Ñ·¥ã B·¥á ü·¥è·¥° B·¥ú·¥õ·¥õ·¥è…¥ T·¥è A·¥Ö·¥Ö B·¥è·¥õ I…¥ Y·¥è·¥ú Ä G Ä·¥è·¥ú·¥ò. B·¥Äs…™·¥Ñ T·¥è·¥ú Ä S·¥õ·¥Ä Ä·¥õ·¥á·¥Ö T·¥è K…¥·¥è·¥° A ô·¥è·¥ú·¥õ H·¥è·¥° T·¥è Us·¥á M·¥á*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="s·¥á·¥õ·¥ú·¥ò ·¥õ·¥ú·¥õ·¥è Ä…™·¥Ä ü ", callback_data="tiana_vida")],<br/>[InlineKeyboardButton(text="·¥Ä·¥Ö·¥Ö ·¥ç·¥á ·¥õ·¥è  è·¥è·¥ú Ä …¢ Ä·¥è·¥ú·¥ò", url=f"https://t.me/{BOT_USERNAME}?startgroup=true")], <br/>[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_"),<br/>InlineKeyboardButton(text="‚û°Ô∏è", callback_data="tiana_helpa")]<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_helpa":<br/>query.message.edit_text(<br/>text=f"""<b>H·¥á è, W·¥á ü·¥Ñ·¥è·¥ç·¥á T·¥è C·¥è…¥“ì…™…¢·¥ú Ä·¥Ä·¥õ…™·¥è…¥ T·¥ú·¥õ·¥è Ä…™·¥Ä ü</b><div></div><b>B·¥á“ì·¥è Ä·¥á W·¥á G·¥è, I N·¥á·¥á·¥Ö A·¥Ö·¥ç…™…¥ P·¥á Ä·¥ç…™ss…™·¥è…¥s I…¥ T ú…™s C ú·¥Ä·¥õ T·¥è W·¥è Ä·¥ã P Ä·¥è·¥ò·¥á Ä ü è.<br/>1). C ü…™·¥Ñ·¥ã M·¥Ä…¥·¥Ä…¢·¥á G Ä·¥è·¥ú·¥ò.<br/>2). G·¥è T·¥è A·¥Ö·¥ç…™…¥…™s·¥õ Ä·¥Ä·¥õ·¥è Äs A…¥·¥Ö A·¥Ö·¥Ö</b> {BOT_USERNAME} <b>As A·¥Ö·¥ç…™…¥.<br/>3). G…™·¥†…™…¥…¢ F·¥ú ü ü P·¥á Ä·¥ç…™ss…™·¥è…¥s M·¥Ä·¥ã·¥á T·¥á·¥Ñ ú…¥·¥è F·¥ú ü ü è Us·¥á“ì·¥ú ü</b>""",<br/>parse_mode=ParseMode.HTML,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="‚¨ÖÔ∏è", callback_data="tiana_help"),<br/>InlineKeyboardButton(text="‚û°Ô∏è", callback_data="tiana_helpb")], <br/>]<br/>),<br/>)<br/>elif query.data == "tiana_helpb":<br/>query.message.edit_text(<br/>text="""*C·¥è…¥…¢ Ä·¥Ä…¢·¥ú ü·¥Ä·¥õ…™·¥è…¥s, T ú…™Íú± B·¥è·¥õ N·¥è·¥° R·¥á·¥Ä·¥Ö è T·¥è M·¥Ä…¥·¥Ä…¢·¥á Y·¥è·¥ú Ä G Ä·¥è·¥ú·¥ò<div></div>H·¥á Ä·¥á A Ä·¥á S·¥è·¥ç·¥á Ess·¥á…¥·¥õ…™·¥Ä ü·¥õ T·¥è T Ä è O…¥ ·¥õ·¥á·¥Ñ ú…¥·¥è.<div></div>√ó A·¥Ö·¥ç…™…¥ T·¥è·¥è üs<br/> ô·¥Äs…™·¥Ñ ·¥Ä·¥Ö·¥ç…™…¥ ·¥õ·¥è·¥è üs  ú·¥á ü·¥ò  è·¥è·¥ú ·¥õ·¥è ·¥ò Ä·¥è·¥õ·¥á·¥Ñ·¥õ ·¥Ä…¥·¥Ö ·¥ò·¥è·¥°·¥á Ä·¥ú·¥ò  è·¥è·¥ú Ä …¢ Ä·¥è·¥ú·¥ò<br/> è·¥è·¥ú ·¥Ñ·¥Ä…¥  ô·¥Ä…¥ ·¥ç·¥á·¥ç ô·¥á Äs, ·¥ã…™·¥Ñ·¥ã ·¥ç·¥á·¥ç ô·¥á Äs, ·¥ò Ä·¥è·¥ç·¥è·¥õ·¥á s·¥è·¥ç·¥á·¥è…¥·¥á ·¥Äs ·¥Ä·¥Ö·¥ç…™…¥ ·¥õ ú Ä·¥è·¥ú…¢ ú ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ös ·¥è“ì  ô·¥è·¥õ<div></div>√ó W·¥á ü·¥Ñ·¥è·¥ç·¥ás<br/> ü·¥á·¥õs s·¥á·¥õ ·¥Ä ·¥°·¥á ü·¥Ñ·¥è·¥ç·¥á ·¥ç·¥áss·¥Ä…¢·¥á ·¥õ·¥è ·¥°·¥á ü·¥Ñ·¥è·¥ç·¥á …¥·¥á·¥° ·¥ús·¥á Äs ·¥Ñ·¥è·¥ç…™…¥…¢ ·¥õ·¥è  è·¥è·¥ú Ä …¢ Ä·¥è·¥ú·¥ò<br/>s·¥á…¥·¥Ö /setwelcome [·¥ç·¥áss·¥Ä…¢·¥á] ·¥õ·¥è s·¥á·¥õ ·¥Ä ·¥°·¥á ü·¥Ñ·¥è·¥ç·¥á ·¥ç·¥áss·¥Ä…¢·¥á<br/>·¥Ä üs·¥è  è·¥è·¥ú ·¥Ñ·¥Ä…¥ s·¥õ·¥è·¥ò ·¥á…¥·¥õ·¥á Ä…™…¥…¢  Ä·¥è ô·¥è·¥õs ·¥è Ä s·¥ò·¥Ä·¥ç·¥ç·¥á Äs ·¥õ·¥è  è·¥è·¥ú Ä ·¥Ñ ú·¥Ä·¥õ  ô è s·¥á·¥õ·¥õ…™…¥…¢ ·¥°·¥á ü·¥Ñ·¥è·¥ç·¥á ·¥Ñ·¥Ä·¥ò·¥õ·¥Ñ ú·¥Ä <div></div>R·¥á“ì·¥á Ä H·¥á ü·¥ò M·¥á…¥·¥ú T·¥è S·¥á·¥á E·¥†·¥á Ä è·¥õ ú…™…¥…¢ I…¥ D·¥á·¥õ·¥Ä…™ ü*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[InlineKeyboardButton(text="‚¨ÖÔ∏è", callback_data="tiana_helpa"),<br/>InlineKeyboardButton(text="‚û°Ô∏è", callback_data="tiana_helpc")]<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_helpc":<br/>query.message.edit_text(<br/>text="""*√ó F…™ ü·¥õ·¥á Äs<br/>“ì…™ ü·¥õ·¥á Äs ·¥Ñ·¥Ä…¥  ô·¥á ·¥ús·¥á·¥Ö ·¥Äs ·¥Ä·¥ú·¥õ·¥è·¥ç·¥Ä·¥õ·¥á·¥Ö  Ä·¥á·¥ò ü…™·¥ás/ ô·¥Ä…¥/·¥Ö·¥á ü·¥á·¥õ·¥á ·¥° ú·¥á…¥ s·¥è·¥ç·¥á·¥è…¥·¥á ·¥ús·¥á ·¥Ä ·¥°·¥è Ä·¥Ö ·¥è Ä s·¥á…¥·¥õ·¥á…¥·¥Ñ·¥á<br/>“ì·¥è Ä ·¥áx·¥Ä·¥ç·¥ò ü·¥á …™“ì …™ “ì…™ ü·¥õ·¥á Ä ·¥°·¥è Ä·¥Ö ' ú·¥á ü ü·¥è' ·¥Ä…¥·¥Ö s·¥á·¥õ  Ä·¥á·¥ò ü è ·¥Äs ' ú…™'<br/> ô·¥è·¥õ ·¥°…™ ü ü  Ä·¥á·¥ò ü è ·¥Äs ' ú…™' ·¥° ú·¥á…¥ s·¥è·¥ç·¥á·¥è…¥·¥á s·¥Ä è ' ú·¥á ü ü·¥è'<br/> è·¥è·¥ú ·¥Ñ·¥Ä…¥ ·¥Ä·¥Ö·¥Ö “ì…™ ü·¥õ·¥á Äs  ô è s·¥á…¥·¥Ö…™…¥…¢ /filter “ì…™ ü·¥õ·¥á Ä …¥·¥Ä·¥ç·¥á<div></div>√ó A…™ C ú·¥Ä·¥õB·¥è·¥õ<br/>·¥°·¥Ä…¥·¥õ s·¥è·¥ç·¥á·¥è…¥·¥á ·¥õ·¥è ·¥Ñ ú·¥Ä·¥õ …™…¥ …¢ Ä·¥è·¥ú·¥ò?<br/>T·¥á·¥Ñ ú…¥·¥è  ú·¥Äs ·¥Ä…¥ …™…¥·¥õ·¥á ü ü…™…¢·¥á…¥·¥õ ·¥Ñ ú·¥Ä·¥õ ô·¥è·¥õ ·¥°…™·¥õ ú ·¥ç·¥ú ü·¥õ…™ ü·¥Ä…¥…¢ s·¥ú·¥ò·¥ò·¥è Ä·¥õ<br/> ü·¥á·¥õ's ·¥õ Ä è …™·¥õ,<br/>S·¥á…¥·¥Ö /chatbot O…¥ A…¥·¥Ö R·¥á·¥ò ü è T·¥è A…¥ è O“ì M è M·¥áss·¥Ä…¢·¥ás T·¥è S·¥á·¥á T ú·¥á M·¥Ä…¢…™·¥Ñ*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[InlineKeyboardButton(text="‚¨ÖÔ∏è", callback_data="tiana_helpb"),<br/>InlineKeyboardButton(text="‚û°Ô∏è", callback_data="tiana_helpd")]<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_helpd":<br/>query.message.edit_text(<br/>text="""*√ó S·¥á·¥õ·¥õ…™…¥…¢ U·¥ò N·¥è·¥õ·¥ás<br/> è·¥è·¥ú ·¥Ñ·¥Ä…¥ s·¥Ä·¥†·¥á ·¥ç·¥áss·¥Ä…¢·¥á/·¥ç·¥á·¥Ö…™·¥Ä/·¥Ä·¥ú·¥Ö…™·¥è ·¥è Ä ·¥Ä…¥ è·¥õ ú…™…¥…¢ ·¥Äs …¥·¥è·¥õ·¥ás ·¥ús…™…¥…¢ /notes<br/>·¥õ·¥è …¢·¥á·¥õ ·¥Ä …¥·¥è·¥õ·¥á s…™·¥ç·¥ò ü è ·¥ús·¥á # ·¥Ä·¥õ ·¥õ ú·¥á  ô·¥á…¢…™…¥…¥…™…¥…¢ ·¥è“ì ·¥Ä ·¥°·¥è Ä·¥Ö<br/>s·¥á·¥á ·¥õ ú·¥á …™·¥ç·¥Ä…¢·¥á..<div></div>√ó S·¥á·¥õ·¥õ…™…¥…¢ U·¥ò N…™…¢ ú·¥õ·¥ç·¥è·¥Ö·¥á<br/> è·¥è·¥ú ·¥Ñ·¥Ä…¥ s·¥á·¥õ ·¥ú·¥ò …¥…™…¢ ú·¥õ·¥ç·¥è·¥Ö·¥á ·¥ús…™…¥…¢ /nightmode ·¥è…¥/·¥è“ì“ì ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ö.<div></div>N·¥è·¥õ·¥á- …¥…™…¢ ú·¥õ ·¥ç·¥è·¥Ö·¥á ·¥Ñ ú·¥Ä·¥õs …¢·¥á·¥õ ·¥Ä·¥ú·¥õ·¥è·¥ç·¥Ä·¥õ…™·¥Ñ·¥Ä ü ü è ·¥Ñ ü·¥ès·¥á·¥Ö ·¥Ä·¥õ 12·¥ò·¥ç(…™s·¥õ)<br/>·¥Ä…¥·¥Ö ·¥Ä·¥ú·¥õ·¥è·¥ç·¥Ä·¥õ…™·¥Ñ·¥Ä ü ü è ·¥è·¥ò·¥á…¥…¥·¥á·¥Ö ·¥Ä·¥õ 6·¥Ä·¥ç(…™s·¥õ) ·¥õ·¥è ·¥ò Ä·¥á·¥†·¥á…¥·¥õ …¥…™…¢ ú·¥õ s·¥ò·¥Ä·¥çs.*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[InlineKeyboardButton(text="‚¨ÖÔ∏è", callback_data="tiana_helpc"),<br/>InlineKeyboardButton(text="‚û°Ô∏è", callback_data="tiana_helpe")]<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_term":<br/>query.message.edit_text(<br/>text=f"""‚úó *Terms and Conditions:*<div></div>- Only your first name, last name (if any) and username (if any) is stored for a convenient communication!<br/>- No group ID or it's messages are stored, we respect everyone's privacy.<br/>- Messages between Bot and you is only infront of your eyes and there is no backuse of it.<br/>- Watch your group, if someone is spamming your group, you can use the report feature of your Telegram Client.<br/>- Do not spam commands, buttons, or anything in bot PM.<div></div>*NOTE:* Terms and Conditions might change anytime""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[InlineKeyboardButton(text="·¥ú·¥ò·¥Ö·¥Ä·¥õ·¥ás", url=f"https://t.me/{UPDATE_CHANNEL}"), <br/>InlineKeyboardButton(text="s·¥ú·¥ò·¥ò·¥è Ä·¥õ", url=f"https://t.me/{SUPPORT_CHAT}")], <br/>[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="about_")]]<br/>),<br/>)<br/>elif query.data == "tiana_helpe":<br/>query.message.edit_text(<br/>text="""*√ó S·¥è N·¥è·¥° Y·¥è·¥ú A Ä·¥á A·¥õ T ú·¥á E…¥·¥Ö O“ì B·¥Äs…™·¥Ñ T·¥è·¥ú Ä. B·¥ú·¥õ T ú…™s Is N·¥è·¥õ A ü ü I C·¥Ä…¥ D·¥è.<div></div>S·¥á…¥·¥Ö /help I…¥ B·¥è·¥õ P·¥ç T·¥è A·¥Ñ·¥Ñ·¥áss H·¥á ü·¥ò M·¥á…¥·¥ú<div></div>T ú·¥á Ä·¥á A Ä·¥á M·¥Ä…¥ è H·¥Ä…¥·¥Ö è T·¥è·¥è üs T·¥è T Ä è O·¥ú·¥õ. <br/>A…¥·¥Ö A üs·¥è I“ì Y·¥è·¥ú H·¥Ä·¥†·¥á A…¥ è S·¥ú…¢…¢·¥áss…™·¥è…¥s A ô·¥è·¥ú·¥õ M·¥á, D·¥è…¥'·¥õ F·¥è Ä…¢·¥á·¥õ T·¥è t·¥á ü ü T ú·¥á·¥ç T·¥è D·¥á·¥†s<div></div>A…¢·¥Ä…™…¥ T ú·¥Ä…¥·¥ãs F·¥è Ä Us…™…¥…¢ M·¥á<div></div>√ó B è Us…™…¥…¢ T ú…™Íú± B·¥è·¥õ Y·¥è·¥ú A Ä·¥á A…¢ Ä·¥á·¥á·¥Ö T·¥è O·¥ú Ä T·¥á Ä·¥çs & C·¥è…¥·¥Ö…™·¥õ…™·¥è…¥s*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="·¥Ä ü ü ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ös", callback_data="help_back")],<br/>[InlineKeyboardButton(text="‚¨ÖÔ∏è", callback_data="tiana_helpd"),<br/>InlineKeyboardButton(text="·¥ç·¥Ä…™…¥ ·¥ç·¥á…¥·¥ú", callback_data="tiana_")]]<br/>),<br/>)<br/>elif query.data == "tiana_music":<br/>query.message.edit_text(<br/>text=f"""*H·¥á Ä·¥á IÍú± T ú·¥á H·¥á ü·¥ò „ÄåAÍú±Íú±…™Íú±·¥õ·¥Ä…¥·¥õ„Äç M·¥è·¥Ö·¥ú ü·¥á:*<div></div>1.) first, add me to your group.<div></div>2.) then promote me as admin and give all permissions except anonymous admin.<div></div>3.) add Assistant to your group using /userbotjoin.<div></div>4.) turn on the video chat first before start to play music.<div></div>*Lets Enjoy Music Bot And Join Support Group*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="s·¥á·¥õ·¥ú·¥ò ·¥õ·¥ú·¥õ·¥è Ä…™·¥Ä ü", callback_data="tiana_vidb")],<br/>[InlineKeyboardButton(text="·¥ò ü·¥Ä è ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ös", callback_data="tiana_musica"),<br/>InlineKeyboardButton(text=" ô·¥è·¥õ ·¥Ñ·¥ç·¥ç·¥Ä…¥·¥Ös", callback_data="tiana_musicc")],<br/>[InlineKeyboardButton(text="·¥Ä·¥Ö·¥ç…™…¥s ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ö", callback_data="tiana_musicb"),<br/>InlineKeyboardButton(text="·¥áx·¥õ Ä·¥Ä ·¥Ñ·¥è·¥ç·¥ç·¥Ä…¥·¥Ös", callback_data="tiana_musicd")],<br/>[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_")]<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_musica":<br/>query.message.edit_text(<br/>text="""‚úó*Here is the help for Play Commands*:<div></div>*Note*: Techno Music Bot works on a single merged commands for Music and Video<div></div>‚úó *Youtube and Telegram Files*:<div></div>/play [Reply to any Video or Audio] or [YT Link] or [Music Name] <br/>- Stream Video or Music on Voice Chat by selecting inline Buttons you get<div></div><br/>‚úó *Techno Database Saved Playlists*:<div></div>/createplaylist<br/>- Create Your Playlist on Tiana's Server with Custom Name<div></div>/playlist <br/>- Check Your Saved Playlist On Servers.<div></div>/deleteplaylist<br/>- Delete any saved music in your playlist<div></div>/playplaylist <br/>- Start playing Your Saved Playlist on Tiana Servers.""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_music")]]<br/>),<br/>)<br/>elif query.data == "tiana_musicb":<br/>query.message.edit_text(<br/>text="""‚úó *Here is the help for Admin Commands*:<div></div><br/>‚úó *Admin Commands*:<div></div>/pause <br/>- Pause the playing music on voice chat.<div></div>/resume<br/>- Resume the paused music on voice chat.<div></div>/skip<br/>- Skip the current playing music on voice chat<div></div>/end or /stop<br/>- Stop the playout.<div></div><br/>‚úó *Authorised Users List*:<div></div>T·¥á·¥Ñ ú…¥·¥è has a additional feature for non-admin users who want to use admin commands<br/>-Auth users can skip, pause, stop, resume Voice Chats even without Admin Rights.<div></div><br/>/auth [Username or Reply to a Message] <br/>- Add a user to AUTH LIST of the group.<div></div>/unauth [Username or Reply to a Message] <br/>- Remove a user from AUTH LIST of the group.<div></div>/authusers <br/>- Check AUTH LIST of the group.""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_music")]]<br/>),<br/>)<br/>elif query.data == "tiana_musicc":<br/>query.message.edit_text(<br/>text="""‚úó *Here is the help for Bot Commands*:<div></div><br/>/start <br/>- Start the ·¥õ·¥á·¥Ñ ú…¥·¥è Music Bot.<div></div>/help <br/>- Get Commands Helper Menu with detailed explanations of commands.<div></div>/settings <br/>- Get Settings dashboard of a group. You can manage Auth Users Mode. Commands Mode from here.<div></div>/ping<br/>- Ping the Bot and check Ram, Cpu etc stats of Tiana.""",<br/>parse_mode=ParseMode.HTML,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_music")]]<br/>),<br/>)<br/>elif query.data == "tiana_musicd":<br/>query.message.edit_text(<br/>text=""" *Here is the help for Extra Commands*:<div></div>/lyrics [Music Name]<br/>- Searches Lyrics for the particular Music on web.<div></div>/sudolist <br/>- Check Sudo Users of Tiana Music Bot<div></div>/song [Track Name] or [YT Link]<br/>- Download any track from youtube in mp3 or mp4 formats via Tiana.<div></div>/queue<br/>- Check Queue List of Music.<div></div>/cleanmode [Enable|Disable]<br/>- When enabled, Tiana will be deleting her 3rd last message to keep your chat clean.""",<br/>parse_mode=ParseMode.HTML,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="tiana_music")]]<br/>),<br/>)<br/>elif query.data == "tiana_about":<br/>query.message.edit_text(<br/>text=f"""{BOT_NAME} it's online since January 2022 and it's constantly updated!<div></div>Bot Admins<div></div>‚Ä¢ @{OWNER_USERNAME}, bot creator and main developer.<div></div>‚Ä¢ The Doctor, server manager and developer.<div></div>‚Ä¢ Manuel 5, developer.<div></div>Support<div></div>‚Ä¢ [Click here](https://t.me/{SUPPORT_CHAT}) to consult the updated list of Official Supporters of the bot.<div></div>‚Ä¢ Thanks to all our donors for supporting server and development expenses and all those who have reported bugs or suggested new features.<div></div>‚Ä¢ We also thank all the groups who rely on our Bot for this service, we hope you will always like it: we are constantly working to improve it!""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="about_")]]<br/>),<br/>)<br/>elif query.data == "tiana_support":<br/>query.message.edit_text(<br/>text=f"*{BOT_NAME} Support Chats*",<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(text="N·¥á·¥°Íú±", url=f"t.me/{UPDATE_CHANNEL}"),<br/>InlineKeyboardButton(text="D·¥è…¥·¥Ä·¥õ·¥á M·¥á", url=f"{DONATION_LINK}"),<br/>],<br/>[<br/>InlineKeyboardButton(text="S·¥ú·¥ò·¥ò·¥è Ä·¥õ", url=f"t.me/{SUPPORT_CHAT}"),<br/>InlineKeyboardButton(text="U·¥ò·¥Ö·¥Ä·¥õ·¥áÍú±", url=f"https://t.me/{UPDATE_CHANNEL}"),<br/>],<br/>[<br/>InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="about_"),<div></div>]<br/>]<br/>),<br/>)<br/>elif query.data == "tiana_source":<br/>query.message.edit_text(<br/>text="""*·¥õ·¥á·¥Ñ ú…¥·¥è  ô·¥è·¥õ is Now Open Source Bot Project.*<div></div>*Click below Button to Get Source Code.*""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(text="üìÑ s·¥è·¥ú Ä·¥Ñ·¥á", url="github.com/Prince-Botz/Tianabot"), <br/>InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="about_"),<br/>] <br/>]<br/>),<br/>)<br/>elif query.data == "tiana_vida":<br/>query.message.reply_video(<br/>TIANA_VIDA,<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True, <br/>)<br/>elif query.data == "tiana_vidb":<br/>query.message.reply_video(<br/>TIANA_VIDB,<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True, <br/>)<div></div>@run_async<br/>def tiana_about_callback(update: Update, context: CallbackContext):<br/>query = update.callback_query<br/>if query.data == "about_":<br/>query.message.edit_text(<br/>text="""·¥Ñ ü…™·¥Ñ·¥ã  ô·¥á ü·¥è·¥°  ô·¥ú·¥õ·¥õ·¥è…¥ “ì·¥è Ä ·¥ã…¥·¥è·¥° ·¥ç·¥è Ä·¥á ·¥Ä ô·¥è·¥ú·¥õ ·¥ç·¥á""",<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(text="·¥Ä ô·¥è·¥ú·¥õ", callback_data="tiana_about"),<br/>InlineKeyboardButton(text="s·¥è·¥ú Ä·¥Ñ·¥á", callback_data="tiana_source"),<br/>],<br/>[ <br/>InlineKeyboardButton(text="s·¥ú·¥ò·¥ò·¥è Ä·¥õ", callback_data="tiana_support"),<br/>InlineKeyboardButton(text="·¥è·¥°…¥·¥á Ä", url=f"t.me/{OWNER_USERNAME}"),<br/>],<br/>[<br/>InlineKeyboardButton(text="·¥õ·¥á·¥Ä Ä·¥çs ·¥Ä…¥·¥Ö ·¥Ñ·¥è…¥·¥Ö…™·¥õ…™·¥è…¥", callback_data="tiana_term"),<br/>],<br/>[<br/>InlineKeyboardButton(text="üîô  ô·¥Ä·¥Ñ·¥ã", callback_data="about_back"),<br/>] <br/>]<br/>),<br/>)<br/>elif query.data == "about_back":<br/>first_name = update.effective_user.first_name<br/>uptime = get_readable_time((time.time() - StartTime))<br/>query.message.edit_text(<br/>PM_START_TEXT.format(<br/>escape_markdown(first_name),<br/>START_IMG,<br/>escape_markdown(uptime),<br/>sql.num_users(),<br/>sql.num_chats()),<br/>reply_markup=InlineKeyboardMarkup(buttons),<br/>parse_mode=ParseMode.MARKDOWN,<br/>timeout=60,<br/>disable_web_page_preview=False,<br/>)<div></div>@run_async<br/>def get_help(update: Update, context: CallbackContext):<br/>chat = update.effective_chat # type: Optional[Chat]<br/>args = update.effective_message.text.split(None, 1)<div></div># ONLY send help in PM<br/>if chat.type != chat.PRIVATE:<br/>if len(args) >= 2 and any(args[1].lower() == x for x in HELPABLE):<br/>module = args[1].lower()<br/>update.effective_message.reply_text(<br/>f"Contact me in PM to get help of {module.capitalize()}",<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(<br/>text="Help",<br/>url="t.me/{}?start=ghelp_{}".format(<br/>context.bot.username, module<br/>),<br/>)<br/>]<br/>]<br/>),<br/>)<br/>return<br/>update.effective_message.reply_text(<br/>"Contact me in PM to get the list of possible commands.",<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(<br/>text="Help",<br/>url="t.me/{}?start=help".format(context.bot.username),<br/>)<br/>]<br/>]<br/>),<br/>)<br/>return<div></div>elif len(args) >= 2 and any(args[1].lower() == x for x in HELPABLE):<br/>module = args[1].lower()<br/>text = (<br/>"Here is the available help for the *{}* module:\n".format(<br/>HELPABLE[module].__mod_name__<br/>)<br/>+ HELPABLE[module].__help__<br/>)<br/>send_help(<br/>chat.id,<br/>text,<br/>InlineKeyboardMarkup(<br/>[[InlineKeyboardButton(text="Back", callback_data="tiana_")]]<br/>),<br/>)<div></div>else:<br/>send_help(chat.id, HELP_STRINGS)<div></div><br/>def send_settings(chat_id, user_id, user=False):<br/>if user:<br/>if USER_SETTINGS:<br/>settings = "\n\n".join(<br/>"*{}*:\n{}".format(mod.__mod_name__, mod.__user_settings__(user_id))<br/>for mod in USER_SETTINGS.values()<br/>)<br/>dispatcher.bot.send_message(<br/>user_id,<br/>"These are your current settings:" + "\n\n" + settings,<br/>parse_mode=ParseMode.MARKDOWN,<br/>)<div></div>else:<br/>dispatcher.bot.send_message(<br/>user_id,<br/>"Seems like there aren't any user specific settings available :'(",<br/>parse_mode=ParseMode.MARKDOWN,<br/>)<div></div>else:<br/>if CHAT_SETTINGS:<br/>chat_name = dispatcher.bot.getChat(chat_id).title<br/>dispatcher.bot.send_message(<br/>user_id,<br/>text="Which module would you like to check {}'s settings for?".format(<br/>chat_name<br/>),<br/>reply_markup=InlineKeyboardMarkup(<br/>paginate_modules(0, CHAT_SETTINGS, "stngs", chat=chat_id)<br/>),<br/>)<br/>else:<br/>dispatcher.bot.send_message(<br/>user_id,<br/>"Seems like there aren't any chat settings available :'(\nSend this "<br/>"in a group chat you're admin in to find its current settings!",<br/>parse_mode=ParseMode.MARKDOWN,<br/>)<div></div><br/>@run_async<br/>def settings_button(update: Update, context: CallbackContext):<br/>query = update.callback_query<br/>user = update.effective_user<br/>bot = context.bot<br/>mod_match = re.match(r"stngs_module\((.+?),(.+?)\)", query.data)<br/>prev_match = re.match(r"stngs_prev\((.+?),(.+?)\)", query.data)<br/>next_match = re.match(r"stngs_next\((.+?),(.+?)\)", query.data)<br/>back_match = re.match(r"stngs_back\((.+?)\)", query.data)<br/>try:<br/>if mod_match:<br/>chat_id = mod_match.group(1)<br/>module = mod_match.group(2)<br/>chat = bot.get_chat(chat_id)<br/>text = "*{}* has the following settings for the *{}* module:\n\n".format(<br/>escape_markdown(chat.title), CHAT_SETTINGS[module].__mod_name__<br/>) + CHAT_SETTINGS[module].__chat_settings__(chat_id, user.id)<br/>query.message.reply_text(<br/>text=text,<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(<br/>text="Back",<br/>callback_data="stngs_back({})".format(chat_id),<br/>)<br/>]<br/>]<br/>),<br/>)<div></div>elif prev_match:<br/>chat_id = prev_match.group(1)<br/>curr_page = int(prev_match.group(2))<br/>chat = bot.get_chat(chat_id)<br/>query.message.reply_text(<br/>"Hi there! There are quite a few settings for {} - go ahead and pick what "<br/>"you're interested in.".format(chat.title),<br/>reply_markup=InlineKeyboardMarkup(<br/>paginate_modules(<br/>curr_page - 1, CHAT_SETTINGS, "stngs", chat=chat_id<br/>)<br/>),<br/>)<div></div>elif next_match:<br/>chat_id = next_match.group(1)<br/>next_page = int(next_match.group(2))<br/>chat = bot.get_chat(chat_id)<br/>query.message.reply_text(<br/>"Hi there! There are quite a few settings for {} - go ahead and pick what "<br/>"you're interested in.".format(chat.title),<br/>reply_markup=InlineKeyboardMarkup(<br/>paginate_modules(<br/>next_page + 1, CHAT_SETTINGS, "stngs", chat=chat_id<br/>)<br/>),<br/>)<div></div>elif back_match:<br/>chat_id = back_match.group(1)<br/>chat = bot.get_chat(chat_id)<br/>query.message.reply_text(<br/>text="Hi there! There are quite a few settings for {} - go ahead and pick what "<br/>"you're interested in.".format(escape_markdown(chat.title)),<br/>parse_mode=ParseMode.MARKDOWN,<br/>reply_markup=InlineKeyboardMarkup(<br/>paginate_modules(0, CHAT_SETTINGS, "stngs", chat=chat_id)<br/>),<br/>)<div></div># ensure no spinny white circle<br/>bot.answer_callback_query(query.id)<br/>query.message.delete()<br/>except BadRequest as excp:<br/>if excp.message not in [<br/>"Message is not modified",<br/>"Query_id_invalid",<br/>"Message can't be deleted",<br/>]:<br/>LOGGER.exception("Exception in settings buttons. %s", str(query.data))<div></div><br/>@run_async<br/>def get_settings(update: Update, context: CallbackContext):<br/>chat = update.effective_chat # type: Optional[Chat]<br/>user = update.effective_user # type: Optional[User]<br/>msg = update.effective_message # type: Optional[Message]<div></div># ONLY send settings in PM<br/>if chat.type != chat.PRIVATE:<br/>if is_user_admin(chat, user.id):<br/>text = "Click here to get this chat's settings, as well as yours."<br/>msg.reply_text(<br/>text,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[<br/>InlineKeyboardButton(<br/>text="Settings",<br/>url="t.me/{}?start=stngs_{}".format(<br/>context.bot.username, chat.id<br/>),<br/>)<br/>]<br/>]<br/>),<br/>)<br/>else:<br/>text = "Click here to check your settings."<div></div>else:<br/>send_settings(chat.id, user.id, True)<div></div><br/>@run_async<br/>def donate(update: Update, context: CallbackContext):<br/>user = update.effective_message.from_user<br/>chat = update.effective_chat # type: Optional[Chat]<br/>bot = context.bot<br/>if chat.type == "private":<br/>update.effective_message.reply_text(<br/>text = " è·¥è·¥ú ·¥Ñ·¥Ä…¥ ·¥Ö·¥è…¥·¥Ä·¥õ·¥á ·¥ç·¥á  ú·¥á Ä·¥á", parse_mode=ParseMode.MARKDOWN, disable_web_page_preview=True, reply_markup=InlineKeyboardMarkup(<br/>[<br/>[ <br/>InlineKeyboardButton(text="D·¥è…¥·¥Ä·¥õ·¥á M·¥á", url=f"{DONATION_LINK}"),<br/>]<br/>]<br/>)<br/>)<br/>else:<br/>try:<br/>bot.send_message(<br/>user.id,<br/>text = " è·¥è·¥ú ·¥Ñ·¥Ä…¥ ·¥Ö·¥è…¥·¥Ä·¥õ·¥á ·¥ç·¥á  ú·¥á Ä·¥á" ,<br/>parse_mode=ParseMode.MARKDOWN,<br/>disable_web_page_preview=True,<br/>reply_markup=InlineKeyboardMarkup(<br/>[<br/>[ <br/>InlineKeyboardButton(text="D·¥è…¥·¥Ä·¥õ·¥á M·¥á", url=f"{DONATION_LINK}"),<br/>]<br/>]<br/>)<br/>)<div></div>update.effective_message.reply_text(<br/>"I've PM'ed you about donating to my creator!"<br/>)<br/>except Unauthorized:<br/>update.effective_message.reply_text(<br/>"Contact me in PM first to get donation information."<br/>)<div></div><br/>def migrate_chats(update: Update, context: CallbackContext):<br/>msg = update.effective_message # type: Optional[Message]<br/>if msg.migrate_to_chat_id:<br/>old_chat = update.effective_chat.id<br/>new_chat = msg.migrate_to_chat_id<br/>elif msg.migrate_from_chat_id:<br/>old_chat = msg.migrate_from_chat_id<br/>new_chat = update.effective_chat.id<br/>else:<br/>return<div></div>LOGGER.info("Migrating from %s, to %s", str(old_chat), str(new_chat))<br/>for mod in MIGRATEABLE:<br/>mod.__migrate__(old_chat, new_chat)<div></div>LOGGER.info("Successfully migrated!")<br/>raise DispatcherHandlerStop<div></div><br/>def main():<div></div>if SUPPORT_CHAT is not None and isinstance(SUPPORT_CHAT, str):<br/>try:<br/>dispatcher.bot.sendMessage(f"@{SUPPORT_CHAT}", "·¥õ·¥á·¥Ñ ú…¥·¥è  Ä·¥è ô·¥è·¥õ …™s  Ä·¥ás·¥õ·¥Ä Ä·¥õ·¥á·¥Ö‚úÖ")<br/>except Unauthorized:<br/>LOGGER.warning(<br/>"Bot isnt able to send message to support_chat, go and check!"<br/>)<br/>except BadRequest as e:<br/>LOGGER.warning(e.message)<div></div>test_handler = CommandHandler("test", test)<br/>start_handler = CommandHandler("start", start)<div></div>help_handler = CommandHandler("help", get_help)<br/>help_callback_handler = CallbackQueryHandler(help_button, pattern=r"help_.*")<div></div>settings_handler = CommandHandler("settings", get_settings)<br/>settings_callback_handler = CallbackQueryHandler(settings_button, pattern=r"stngs_")<div></div>about_callback_handler = CallbackQueryHandler(tiana_callback_handler, pattern=r"tiana_")<br/>Tiana_callback_handler = CallbackQueryHandler(tiana_about_callback, pattern=r"about_")<div></div>donate_handler = CommandHandler("donate", donate)<br/>migrate_handler = MessageHandler(Filters.status_update.migrate, migrate_chats)<div></div># dispatcher.add_handler(test_handler)<br/>dispatcher.add_handler(start_handler)<br/>dispatcher.add_handler(help_handler)<br/>dispatcher.add_handler(about_callback_handler)<br/>dispatcher.add_handler(Tiana_callback_handler)<br/>dispatcher.add_handler(settings_handler)<br/>dispatcher.add_handler(help_callback_handler)<br/>dispatcher.add_handler(settings_callback_handler)<br/>dispatcher.add_handler(migrate_handler)<br/>dispatcher.add_handler(donate_handler)<div></div>dispatcher.add_error_handler(error_callback)<div></div>if WEBHOOK:<br/>LOGGER.info("Using webhooks.")<br/>updater.start_webhook(listen="0.0.0.0", port=PORT, url_path=TOKEN)<div></div>if CERT_PATH:<br/>updater.bot.set_webhook(url=URL + TOKEN, certificate=open(CERT_PATH, "rb"))<br/>else:<br/>updater.bot.set_webhook(url=URL + TOKEN)<div></div>else:<br/>LOGGER.info("Started Successfully")<br/>updater.start_polling(timeout=15, read_latency=4, clean=True)<div></div>if len(argv) not in (1, 3, 4):<br/>telethn.disconnect()<br/>else:<br/>telethn.run_until_disconnected()<div></div>updater.idle()<div></div><br/>if __name__ == "__main__":<br/>LOGGER.info("Successfully loaded modules: " + str(ALL_MODULES))<br/>telethn.start(bot_token=TOKEN)<br/>pbot.start()<br/>main()<div></div>